---
title: Deployment
description: Deploy Task Dojo to production
---

Deployment Overview

Task Dojo uses a split deployment strategy:

Frontend: Static SPA â†’ Vercel/Netlify/Cloudflare
Backend: Edge Functions â†’ Supabase (already hosted)
Database: PostgreSQL â†’ Supabase (already hosted)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend (Vercel/Netlify)          â”‚
â”‚  - Static React build                â”‚
â”‚  - Global CDN                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ HTTPS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Supabase Edge Functions            â”‚
â”‚  - Deno + Hono server                â”‚
â”‚  - Global edge network               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Supabase PostgreSQL                â”‚
â”‚  - Managed database                  â”‚
â”‚  - Automatic backups                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

Frontend Deployment

Option 1: Vercel (Recommended)

<Steps>
  <Step title="Install Vercel CLI">
    ```bash
    npm install -g vercel
    ```
  </Step>

  <Step title="Login to Vercel">
    ```bash
    vercel login
    ```
  </Step>

  <Step title="Deploy">
    ```bash
    # First deployment (interactive)
    vercel
    
    # Production deployment
    vercel --prod
    ```
  </Step>

  <Step title="Configure Environment Variables">
    In Vercel Dashboard â†’ Settings â†’ Environment Variables:
    
    ```
    VITE_SUPABASE_URL=https://xxxxx.supabase.co
    VITE_SUPABASE_ANON_KEY=eyJhbG...
    VITE_INTERCOM_APP_ID=your_app_id
    VITE_API_URL=https://xxxxx.supabase.co/functions/v1/make-server-4010be06
    ```
    
    <Note>Add for Production environment</Note>
  </Step>

  <Step title="Deploy Again">
    ```bash
    vercel --prod
    ```
    
    Your site is live at `https://task-dojo.vercel.app`! ğŸ‰
  </Step>
</Steps>

Vercel Configuration (`vercel.json`):

```json
{
  "buildCommand": "npm run build",
  "outputDirectory": "dist",
  "framework": "vite",
  "rewrites": [
    { "source": "/(.*)", "destination": "/index.html" }
  ]
}
```

---

Option 2: Netlify

<Steps>
  <Step title="Install Netlify CLI">
    ```bash
    npm install -g netlify-cli
    ```
  </Step>

  <Step title="Login">
    ```bash
    netlify login
    ```
  </Step>

  <Step title="Initialize Site">
    ```bash
    netlify init
    ```
    
    Follow prompts to create site
  </Step>

  <Step title="Configure Build">
    Create `netlify.toml`:
    
    ```toml
    [build]
      command = "npm run build"
      publish = "dist"
    
    [[redirects]]
      from = "/*"
      to = "/index.html"
      status = 200
    ```
  </Step>

  <Step title="Set Environment Variables">
    ```bash
    netlify env:set VITE_SUPABASE_URL https://xxxxx.supabase.co
    netlify env:set VITE_SUPABASE_ANON_KEY eyJhbG...
    netlify env:set VITE_INTERCOM_APP_ID your_app_id
    netlify env:set VITE_API_URL https://xxxxx.supabase.co/functions/v1/make-server-4010be06
    ```
  </Step>

  <Step title="Deploy">
    ```bash
    netlify deploy --prod
    ```
  </Step>
</Steps>

---

Option 3: Cloudflare Pages

<Steps>
  <Step title="Build Locally">
    ```bash
    npm run build
    ```
  </Step>

  <Step title="Install Wrangler">
    ```bash
    npm install -g wrangler
    ```
  </Step>

  <Step title="Login to Cloudflare">
    ```bash
    wrangler login
    ```
  </Step>

  <Step title="Create Project">
    In Cloudflare Dashboard â†’ Pages â†’ Create Project
    
    Connect your GitHub repo or upload manually
  </Step>

  <Step title="Configure Build">
Build command: `npm run build`
Build output: `dist`
Framework: Vite
  </Step>

  <Step title="Set Environment Variables">
    In Pages settings, add all `VITE_*` variables
  </Step>

  <Step title="Deploy">
    Push to GitHub or use Wrangler:
    
    ```bash
    wrangler pages publish dist
    ```
  </Step>
</Steps>

---

Backend Deployment

Deploy Edge Functions

<Steps>
  <Step title="Ensure Functions are Tested">
    Test locally first:
    
    ```bash
    supabase functions serve server --debug
    ```
  </Step>

  <Step title="Deploy to Supabase">
    ```bash
    supabase functions deploy server
    ```
    
    <Info>Functions deploy to global edge network automatically</Info>
  </Step>

  <Step title="Verify Deployment">
    ```bash
    # Test health endpoint
    curl https://your-project.supabase.co/functions/v1/make-server-4010be06/health
    
    # Should return: {"status":"ok"}
    ```
  </Step>

  <Step title="Monitor Logs">
    ```bash
    supabase functions logs server --tail
    ```
  </Step>
</Steps>

Update Function Secrets

If secrets changed:

```bash
Set new secrets
supabase secrets set OPENAI_API_KEY=sk-new-key

Re-deploy functions
supabase functions deploy server

Verify secrets loaded
supabase secrets list
```

<Warning>
Always re-deploy functions after updating secrets!
</Warning>

---

Database Migration

Production Database Setup

<Steps>
  <Step title="Backup Current Data">
    ```bash
    # Export production data
    supabase db dump --project-ref your-prod-ref > backup.sql
    ```
  </Step>

  <Step title="Apply Migrations">
    ```bash
    # Push all migrations to production
    supabase db push --project-ref your-prod-ref
    ```
  </Step>

  <Step title="Verify Schema">
    ```sql
    -- In Supabase Dashboard SQL Editor
    SELECT table_name 
    FROM information_schema.tables 
    WHERE table_schema = 'public';
    
    -- Should show: kv_store_4010be06
    ```
  </Step>
</Steps>

---

Environment Configuration

Production Environment Variables

Frontend (.env.production):
```bash
VITE_SUPABASE_URL=https://production.supabase.co
VITE_SUPABASE_ANON_KEY=prod_anon_key
VITE_INTERCOM_APP_ID=prod_intercom_id
VITE_API_URL=https://production.supabase.co/functions/v1/make-server-4010be06
```

Backend (Supabase Secrets):
```bash
SUPABASE_URL=https://production.supabase.co
SUPABASE_ANON_KEY=prod_anon_key
SUPABASE_SERVICE_ROLE_KEY=prod_service_role  # CRITICAL!
SUPABASE_DB_URL=postgresql://prod-connection
INTERCOM_IDENTITY_VERIFICATION_SECRET=prod_secret
OPENAI_API_KEY=sk-prod-key  # Or Anthropic
```

---

CI/CD Setup

GitHub Actions (Recommended)

Create `.github/workflows/deploy.yml`:

```yaml
name: Deploy to Production

on:
  push:
    branches: [main]

jobs:
  deploy-frontend:
    runs-on: ubuntu-latest
    steps:
uses: actions/checkout@v3
      
name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
      
name: Install dependencies
        run: npm ci
      
name: Build
        env:
          VITE_SUPABASE_URL: ${{ secrets.VITE_SUPABASE_URL }}
          VITE_SUPABASE_ANON_KEY: ${{ secrets.VITE_SUPABASE_ANON_KEY }}
          VITE_API_URL: ${{ secrets.VITE_API_URL }}
        run: npm run build
      
name: Deploy to Vercel
        uses: amondnet/vercel-action@v20
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          vercel-args: '--prod'

  deploy-backend:
    runs-on: ubuntu-latest
    steps:
uses: actions/checkout@v3
      
name: Setup Supabase CLI
        uses: supabase/setup-cli@v1
      
name: Deploy Edge Functions
        run: supabase functions deploy server
        env:
          SUPABASE_ACCESS_TOKEN: ${{ secrets.SUPABASE_ACCESS_TOKEN }}
          SUPABASE_PROJECT_ID: ${{ secrets.SUPABASE_PROJECT_ID }}
```

Configure GitHub Secrets

In GitHub â†’ Settings â†’ Secrets and Variables â†’ Actions:

```
VITE_SUPABASE_URL
VITE_SUPABASE_ANON_KEY
VITE_API_URL
VERCEL_TOKEN
VERCEL_ORG_ID
VERCEL_PROJECT_ID
SUPABASE_ACCESS_TOKEN
SUPABASE_PROJECT_ID
```

---

Pre-Deployment Checklist

<Steps>
  <Step title="Code Quality">
[ ] All tests passing: `npm test`
[ ] Build succeeds: `npm run build`
[ ] No TypeScript errors: `npm run build`
[ ] No console.log in production code
[ ] Environment variables set correctly
  </Step>

  <Step title="Security">
[ ] SERVICE_ROLE_KEY never exposed to frontend
[ ] All secrets stored in Supabase Secrets
[ ] HTTPS enforced (handled by platforms)
[ ] CORS configured correctly
[ ] Input validation on all endpoints
  </Step>

  <Step title="Performance">
[ ] Images optimized
[ ] Lazy loading implemented
[ ] Code splitting configured
[ ] Build size reasonable (under 500KB)
  </Step>

  <Step title="Functionality">
[ ] Sign up/sign in working
[ ] Task creation working
[ ] Task completion working
[ ] Points calculation correct
[ ] Belt progression working
[ ] Intercom initialized (if enabled)
  </Step>

  <Step title="Database">
[ ] Migrations applied
[ ] Indexes created
[ ] Backups configured
[ ] Connection pooling enabled
  </Step>
</Steps>

---

Post-Deployment Verification

Smoke Tests

Run these tests immediately after deployment:

<AccordionGroup>
  <Accordion title="1. Health Check" icon="heart-pulse">
    ```bash
    curl https://your-app.vercel.app
    # Should return 200 OK
    
    curl https://your-project.supabase.co/functions/v1/make-server-4010be06/health
    # Should return {"status":"ok"}
    ```
  </Accordion>

  <Accordion title="2. Authentication Flow" icon="key">
Visit landing page
Click "Sign Up"
Create account
Verify redirect to dashboard
Sign out
Sign in again
  </Accordion>

  <Accordion title="3. Core Functionality" icon="list-check">
Create a task
Complete the task
Verify points awarded
Check profile updates
Verify belt calculation
  </Accordion>

  <Accordion title="4. API Endpoints" icon="plug">
    ```bash
    # Get profile (requires auth token)
    curl -X GET https://your-project.supabase.co/functions/v1/make-server-4010be06/profile \
      -H "Authorization: Bearer YOUR_TOKEN"
    
    # Should return user profile
    ```
  </Accordion>

  <Accordion title="5. Intercom (if enabled)" icon="messages">
Visit app as logged-in user
Check Intercom widget loads
Send test message
Verify appears in Intercom dashboard
  </Accordion>
</AccordionGroup>

---

Monitoring & Logging

Supabase Logs

View Edge Function logs:

```bash
Real-time logs
supabase functions logs server --tail

Last 100 logs
supabase functions logs server --limit 100

Filter by error
supabase functions logs server --level error
```

Vercel Logs

In Vercel Dashboard:
Deployments â†’ Your deployment â†’ Logs
Real-time logs during deployment
Runtime logs for SSR (not applicable here)

Error Tracking

Recommended: Sentry

```typescript
// utils/sentry.ts
import * as Sentry from "@sentry/react"

if (import.meta.env.PROD) {
  Sentry.init({
    dsn: "YOUR_SENTRY_DSN",
    environment: "production",
    tracesSampleRate: 0.1
  })
}
```

---

Rollback Procedures

Frontend Rollback

Vercel:
```bash
List deployments
vercel ls

Rollback to previous
vercel rollback [deployment-url]

Or in dashboard: Deployments â†’ Previous â†’ Promote to Production
```

Netlify:
Dashboard â†’ Deploys
Find previous successful deploy
Click "Publish deploy"

Backend Rollback

Edge Functions:
```bash
Revert to previous git commit
git revert HEAD
git push

Re-deploy
supabase functions deploy server
```

Database Rollback

Restore from backup:
```bash
List backups
supabase db backups list

Restore specific backup
supabase db restore backup_id
```

<Warning>
Database rollbacks are destructive! Always test in staging first.
</Warning>

---

Scaling Considerations

Traffic Scaling

Automatic Scaling:
âœ… Vercel/Netlify: Auto-scale globally
âœ… Supabase Edge Functions: Auto-scale
âœ… Supabase Database: Auto-scale (paid plans)

Manual Optimization:
Implement CDN caching
Optimize database queries
Add pagination to large lists
Cache insights calculations

Cost Optimization

Free Tier Limits:
Supabase: 500MB database, 2GB bandwidth/month
Vercel: 100GB bandwidth/month
Netlify: 100GB bandwidth/month

Upgrade Triggers:
Database >400MB â†’ Upgrade Supabase
>10K active users â†’ Upgrade compute
>1M API requests/month â†’ Review pricing

---

Troubleshooting Deployment

Build Fails

Error: `npm run build` fails

Solutions:
Check TypeScript errors: `tsc --noEmit`
Verify all dependencies installed: `npm ci`
Check Node version matches (18.x)
Review build logs for specific error

Environment Variables Not Working

Error: `undefined` for env variables

Solutions:
Ensure variables prefixed with `VITE_`
Rebuild after adding variables
Check variable names match exactly (case-sensitive)
Restart dev server

Functions Not Responding

Error: 504 Gateway Timeout

Solutions:
Check function logs: `supabase functions logs server`
Verify secrets are set
Test function locally first
Check database connection

CORS Errors

Error: `CORS policy blocked`

Solutions:
Verify CORS enabled in Edge Functions
Check `origin: '*'` in cors middleware
Ensure Authorization header allowed
Clear browser cache

---

Domain Configuration

Custom Domain (Vercel)

<Steps>
  <Step title="Add Domain">
    Vercel Dashboard â†’ Settings â†’ Domains â†’ Add Domain
  </Step>

  <Step title="Configure DNS">
    Add DNS records:
    
    ```
    Type: A
    Name: @
    Value: 76.76.21.21
    
    Type: CNAME
    Name: www
    Value: cname.vercel-dns.com
    ```
  </Step>

  <Step title="Verify">
    Wait for DNS propagation (up to 48 hours)
    
    Vercel auto-provisions SSL certificate
  </Step>
</Steps>

---

Backup Strategy

Automated Backups

Supabase (automatic):
Daily backups (last 7 days)
Point-in-time recovery (paid plans)

Manual Backups:
```bash
Full database dump
supabase db dump > backup-$(date +%Y%m%d).sql

Specific table
supabase db dump --table kv_store_4010be06 > kv_backup.sql
```

Backup Schedule

Daily: Automatic (Supabase)
Weekly: Manual full backup
Before major changes: Manual backup
Before deployment: Git tag + backup

---

Next Steps

<CardGroup cols={2}>
  <Card title="Monitoring" icon="chart-line" href="/technical/monitoring">
    Set up error tracking and analytics
  </Card>
  
  <Card title="Performance" icon="gauge" href="/technical/performance">
    Optimize for production
  </Card>
  
  <Card title="Security" icon="shield" href="/technical/security">
    Production security checklist
  </Card>
  
  <Card title="API Reference" icon="code" href="/api-reference/overview">
    Complete API documentation
  </Card>
</CardGroup>

---

<Check>
Your deployment is complete! Task Dojo is now live and ready for users. Monitor logs and performance, and iterate based on feedback. ğŸš€
</Check>
